{% extends "base.html" %}
{% block title %}Student Dashboard{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modern.css') }}">
{% endblock %}

{% block content %}
<canvas id="pencil-bg" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none;"></canvas>

<!-- Floating decorative background elements -->
<div class="floating-element" style="width:90px;height:90px;top:12%;left:8%;"></div>
<div class="floating-element" style="width:55px;height:55px;top:70%;left:88%;"></div>
<div class="floating-element" style="width:75px;height:75px;top:45%;left:93%;"></div>
<div class="floating-element" style="width:45px;height:45px;top:25%;left:82%;"></div>

<div class="top-bar">
    <div class="nav-logo">üéì Student Portal</div>
    <div style="display:flex;gap:0.75rem;align-items:center;">
        <div class="user-badge">{{ student.name }}</div>
        <a href="/logout" class="btn-modern btn-secondary" style="padding:8px 20px;font-size:0.88rem;text-decoration:none;">Logout</a>
    </div>
</div>

<div class="dashboard-content page-enter">

    <!-- Expired exam warning -->
    {% if expired_message %}
    <div class="alert-box alert-critical error-shake" style="margin-bottom:1.5rem;">
        <strong>‚è∞ Exam Time Expired</strong><br>
        {{ expired_message }}<br>
        <small>Your exam session has been marked as incomplete. Please contact your invigilator.</small>
    </div>
    {% endif %}

    <!-- Active/resume exam -->
    {% if active_exam %}
    <div class="alert-box alert-warning" style="margin-bottom:1.5rem;">
        <strong>üö® Resume Your Exam</strong><br>
        You have an exam in progress: <strong>{{ active_exam.exam_name }}</strong><br>
        <small>Started: {{ active_exam.start_time.strftime('%Y-%m-%d %H:%M') }}</small><br>
        <a href="/exam/{{ student.student_id }}?session_id={{ active_exam.id }}"
           class="btn-modern btn-warning"
           style="margin-top:0.75rem;text-decoration:none;display:inline-flex;">
            ‚ñ∂ Resume Exam
        </a>
    </div>
    {% endif %}

    <!-- Welcome card -->
    <div class="glass-card card-enter" style="margin-bottom:1.5rem;">
        <h2>Welcome, {{ student.name }}!</h2>
        <p style="margin-top:0.4rem;">Student ID: <strong style="color:white;">{{ student.student_id }}</strong></p>
    </div>

    <!-- Scheduled Exams -->
    <div class="glass-card card-enter">
        <h2 class="section-title">Scheduled Exams</h2>

        {% if scheduled_exams %}
            {% for exam in scheduled_exams %}
            {% set now = now() %}
            {% set can_start = exam.scheduled_start <= now %}
            <div class="exam-card">
                <div class="exam-info">
                    <h3>{{ exam.exam_name }}</h3>
                    <p>üìÖ {{ exam.scheduled_start.strftime('%Y-%m-%d %H:%M') }} &nbsp;¬∑&nbsp; ‚è± {{ exam.duration_minutes }} minutes</p>
                    {% if not can_start %}
                    <p style="color:#fcd34d;margin-top:0.25rem;font-size:0.85rem;">
                        ‚è≥ Starts in {{ ((exam.scheduled_start - now).total_seconds() // 60)|int }} minutes
                    </p>
                    {% else %}
                    <span class="badge badge-active" style="margin-top:0.35rem;">‚óè Available Now</span>
                    {% endif %}
                </div>
                {% if can_start %}
                <a href="/exam/{{ student.student_id }}?session_id={{ exam.id }}"
                   class="btn-modern btn-success"
                   style="flex-shrink:0;text-decoration:none;">
                    ‚ñ∂ Start Exam
                </a>
                {% else %}
                <button class="btn-modern btn-disabled" disabled style="flex-shrink:0;">
                    üîí Not Yet Available
                </button>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">üìö</div>
                <h3>No Scheduled Exams</h3>
                <p>You don't have any upcoming exams at this time. Check back later or contact your instructor.</p>
            </div>
        {% endif %}
    </div>

    <!-- Past Exams (if any) -->
    {% if past_exams %}
    <div class="glass-card card-enter" style="margin-top:1.5rem;">
        <h2 class="section-title">Past Exams</h2>
        {% for exam in past_exams %}
        <div class="exam-card">
            <div class="exam-info">
                <h3>{{ exam.exam_name }}</h3>
                <p>{{ exam.start_time.strftime('%Y-%m-%d %H:%M') if exam.start_time else 'N/A' }}</p>
            </div>
            <span class="badge
                {% if exam.status == 'completed' %}badge-completed
                {% elif exam.status == 'failed' %}badge-failed
                {% else %}badge-scheduled{% endif %}">
                {{ exam.status|title }}
            </span>
        </div>
        {% endfor %}
    </div>
    {% endif %}

</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard-animations.js') }}"></script>
{% endblock %}